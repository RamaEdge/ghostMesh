# AI Explainer Service Documentation

## Overview

The GhostMesh AI Explainer Service provides intelligent explanations for security alerts generated by the anomaly detector. It processes alerts and generates human-readable explanations of potential security risks, helping operators understand and respond to threats effectively.

## Status: ðŸ”„ IN DEVELOPMENT

**Linear Issue:** THE-166  
**Implementation Date:** September 13, 2025  
**Service Name:** `explainer`  
**Container:** `ghostmesh-explainer`

## Core Features

### Alert Processing
- **Alert Subscription:** Subscribes to `alerts/#` topics for real-time alert processing
- **Context Analysis:** Analyzes alert context including asset type, signal type, and severity
- **Historical Data:** Considers recent telemetry patterns for context-aware explanations

### Explanation Generation
- **Risk Assessment:** Evaluates the potential impact and likelihood of threats
- **Plain Language:** Generates explanations in clear, actionable language
- **Confidence Scoring:** Provides confidence levels for explanation accuracy
- **Recommendations:** Suggests appropriate response actions

### MQTT Integration
- **Input Topics:** `alerts/#` - Receives anomaly detection alerts
- **Output Topics:** `explanations/<alertId>` - Publishes explanations for each alert
- **Retention:** Retained messages for explanation persistence
- **QoS Level:** 1 (at least once delivery)

## Architecture

### Data Flow
```
Anomaly Detector â†’ Alerts â†’ AI Explainer â†’ Explanations â†’ Dashboard
```

### Explanation Schema
```json
{
  "alertId": "alert-abc123",
  "text": "Temperature spike detected on Press01 indicates potential overheating. This could lead to equipment failure or safety hazards. Immediate inspection recommended.",
  "confidence": 0.85,
  "riskLevel": "medium",
  "recommendedActions": ["inspect_equipment", "check_cooling_system"],
  "ts": "2025-09-13T12:00:00Z"
}
```

## Implementation Plan

### Phase 1: Basic Explanation Engine
- [ ] Create explainer service structure
- [ ] Implement MQTT client for alert subscription
- [ ] Basic rule-based explanation generation
- [ ] Explanation publishing to MQTT

### Phase 2: Enhanced Intelligence
- [ ] Context-aware explanation generation
- [ ] Historical data analysis
- [ ] Confidence scoring algorithm
- [ ] Risk level assessment

### Phase 3: Integration & Testing
- [ ] Dashboard integration for explanation display
- [ ] End-to-end testing with anomaly detector
- [ ] Performance optimization
- [ ] Documentation and deployment

## Testing Strategy

### Unit Tests
- Explanation generation logic
- MQTT message handling
- Error handling and edge cases

### Integration Tests
- Alert processing pipeline
- Dashboard explanation display
- End-to-end data flow validation

### Performance Tests
- Response time for explanation generation
- Memory usage optimization
- Concurrent alert processing

## Configuration

### Environment Variables
- `MQTT_HOST`: MQTT broker hostname (default: mosquitto)
- `MQTT_PORT`: MQTT broker port (default: 1883)
- `MQTT_USERNAME`: MQTT username (default: explainer)
- `MQTT_PASSWORD`: MQTT password (default: explainerpass)
- `EXPLANATION_TIMEOUT`: Maximum time for explanation generation (default: 5s)

### Dependencies
- `paho-mqtt`: MQTT client library
- `numpy`: Numerical computations
- `pandas`: Data analysis (optional)
- `scikit-learn`: Machine learning (optional)

## Deployment

### Docker Configuration
```dockerfile
FROM python:3.9-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY explainer.py .
CMD ["python", "explainer.py"]
```

### Docker Compose Integration
```yaml
explainer:
  build: ./explainer
  container_name: ghostmesh-explainer
  depends_on:
    mosquitto:
      condition: service_healthy
  environment:
    - MQTT_HOST=mosquitto
    - MQTT_PORT=1883
    - MQTT_USERNAME=explainer
    - MQTT_PASSWORD=explainerpass
  restart: unless-stopped
  networks:
    - ghostmesh-network
```

## Monitoring & Observability

### Metrics
- Alerts processed per minute
- Explanation generation time
- Error rates and types
- Memory and CPU usage

### Logging
- Structured logging with appropriate levels
- Alert processing events
- Explanation generation details
- Error tracking and debugging

## Security Considerations

### Authentication
- MQTT authentication with dedicated user credentials
- ACL permissions for alert reading and explanation publishing
- Secure credential management

### Data Privacy
- No persistent storage of sensitive telemetry data
- Explanation generation without data retention
- Secure communication channels

## Future Enhancements

### Machine Learning Integration
- Local LLM integration for advanced explanations
- Pattern recognition for improved accuracy
- Adaptive learning from operator feedback

### Advanced Features
- Multi-language explanation support
- Customizable explanation templates
- Integration with external threat intelligence
- Automated response recommendations
