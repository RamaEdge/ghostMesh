# Mosquitto configuration for MQTT API Backend Service

# General settings
pid_file /var/run/mosquitto.pid
persistence true
persistence_location /mosquitto/data/
log_dest file /mosquitto/log/mosquitto.log
log_type error
log_type warning
log_type notice
log_type information
log_type debug
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# Network settings
listener 1883 0.0.0.0
protocol mqtt
max_connections 1000
max_inflight_messages 100
max_queued_messages 1000

# WebSocket support
listener 9001 0.0.0.0
protocol websockets

# Security settings
allow_anonymous false
password_file /mosquitto/config/passwd
acl_file /mosquitto/config/acl.conf

# Message settings
max_packet_size 268435456
message_size_limit 268435456
retained_persistence true
persistent_client_expiration 1h

# Connection settings
keepalive_interval 60
max_keepalive 65535
retry_interval 20
max_inflight_bytes 0
max_queued_bytes 0

# Bridge settings (disabled)
# connection bridge-01
# address remote-broker.example.com:1883
# topic factory/+/+ out 0
# topic commands/+/+ in 0

# Performance settings
sys_interval 10
upgrade_outgoing_qos false
queue_qos0_messages false
max_inflight_messages 100
max_queued_messages 1000

# Logging settings
log_facility 5
log_dest stdout
log_dest file /mosquitto/log/mosquitto.log
log_type error
log_type warning
log_type notice
log_type information
log_type debug
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# Client settings
client_id_prefixes ghostmesh-
client_id_max_length 23
auto_id_prefix ghostmesh-

# Persistence settings
persistence true
persistence_location /mosquitto/data/
persistence_file mosquitto.db
persistence_backup true
persistence_backup_interval 1800
persistence_backup_location /mosquitto/data/backup/

# Memory settings
memory_limit 0
max_inflight_bytes 0
max_queued_bytes 0

# Timeout settings
persistent_client_expiration 1h
max_keepalive 65535
retry_interval 20

# QoS settings
upgrade_outgoing_qos false
queue_qos0_messages false

# Subscription settings
subscription_identifier_max 268435455

# Message expiry
message_expiry_interval 0

# Topic alias settings
topic_alias_maximum 10

# User properties
user_property_max_count 0
user_property_max_length 65535

# Request/Response
request_response_information false
request_problem_information false

# Server reference
server_reference http://localhost:8000

# Response information
response_information "GhostMesh MQTT API Backend Service"

# Problem information
problem_information "Contact support at support@ghostmesh.dev"
